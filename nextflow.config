includeConfig "$baseDir/params.config"

process.shell = ['/bin/bash','-e']

manifest {
  name = "DTBW"
  version = '0.1'
}

conda.enabled = true

// needed? (find here better naming)
//process.container = '/scicore/home/schwede/zohixe92/CAMEO/CAMEO_predictors/BaselineCM_AutoDockVina/container_scripts/ADFRsuite.img'

// check if cacheDir = "" needed
singularity {
  autoMounts = 'true'
  singularity.enabled = true
  runOptions = '-B /scratch -B /home'
}

profiles {

   slurm {
     executor {
        name="slurm"
        queueSize = 100
        clusterOptions = '--qos=1day'
        submitRateLimit = '5 sec'
        exitReadTimeout = '30 min'

     }

      process {
        containerOptions = { workflow.containerEngine == "docker" ? '-u $(id -u):$(id -g)': null}
        time = '15 min'
        clusterOptions = '--qos=30min'
        memory = '2G'
        errorStrategy = 'ignore'
        
        withName: 'prepare_pdb_sdf' {
          executor = 'local'
        }
    
        withLabel: 'diffdock' {
          memory = '64G'
          clusterOptions = '--qos=6hours --gres=gpu:1 --partition=a100,rtx8000 --ntasks=10'
          time = { 30.min * task.attempt }
          errorStrategy = { task.attempt <= 3 ? 'retry' : 'ignore' }
          maxRetries = 3
        }
        
        withName: 'tankbind' {
          memory = '50G'
          time = { 30.min * task.attempt }
          errorStrategy = { task.attempt <= 3 ? 'retry' : 'ignore' }
          maxRetries = 3
        }
        
        withName: 'r2rank' {
          memory = '16G'
          time = { 30.min * task.attempt }
          errorStrategy = { task.attempt <= 3 ? 'retry' : 'ignore' }
          maxRetries = 3
        }
        
        withLabel: 'vina_like' {
          memory = '32G'
          time = { 30.min * task.attempt }
          errorStrategy = { task.attempt <= 3 ? 'retry' : 'ignore' }
          maxRetries = 3
        }
     }
   }
}
